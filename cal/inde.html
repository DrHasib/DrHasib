<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Responsive Calculator</title>
  <style>
    :root{
      --bg:#0f1724;
      --panel:#0b1220;
      --accent:#06b6d4;
      --muted:#94a3b8;
      --btn:#111827;
      --btn-op:#1f2937;
      --glass: rgba(255,255,255,0.02);
      --radius:14px;
      --gap:10px;
      --shadow: 0 8px 24px rgba(2,6,23,0.6);
    }
    *{box-sizing:border-box}
    html,body{
      height:100%;
      margin:0;
      font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
      background:linear-gradient(180deg,#04202a 0%, #071125 100%);
      color:#e6eef6;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }
    .wrap{
      min-height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
    }
    .calc{
      width:min(460px,96vw);
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:18px;
      padding:18px;
      box-shadow:var(--shadow);
    }
    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom:12px;
    }
    .title{
      font-weight:600;
      font-size:1.05rem;
      color:var(--accent);
    }
    .subtitle{font-size:0.82rem;color:var(--muted)}
    .display{
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:12px;
      padding:14px;
      margin-bottom:12px;
      display:flex;
      flex-direction:column;
      gap:6px;
      min-height:96px;
      align-items:flex-end;
      justify-content:center;
      word-break:break-all;
      box-shadow: 0 4px 18px rgba(2,6,23,0.5) inset;
    }
    .expression{
      font-size:0.95rem;
      color:var(--muted);
      opacity:0.92;
      width:100%;
      text-align:right;
    }
    .result{
      font-size:2rem;
      font-weight:600;
      color:#e6eef6;
      width:100%;
      text-align:right;
    }

    .pad{
      display:grid;
      grid-template-columns:repeat(4,1fr);
      gap:var(--gap);
    }
    button.key{
      height:64px;
      border-radius:10px;
      border:0;
      background:var(--btn);
      color:inherit;
      font-size:1.1rem;
      box-shadow: 0 4px 10px rgba(2,6,23,0.6);
      transition:transform .06s ease, box-shadow .06s ease, background .12s;
      -webkit-tap-highlight-color: transparent;
    }
    button.key:active{ transform: translateY(2px) scale(.997); }
    button.fn{ background:linear-gradient(180deg,var(--btn-op),#0b1220); color:var(--accent); font-weight:600;}
    button.equal{ grid-column:span 2; background:linear-gradient(180deg,var(--accent),#058cae); color:white; font-weight:700;}
    button.zero{ grid-column: span 1; } /* keep zero single-col for balance */
    button.wide{ grid-column: span 2; }
    .small{ font-size:.95rem }
    /* Responsive tweaks */
    @media (max-width:420px){
      .result{ font-size:1.6rem; }
      button.key{ height:58px; font-size:1.05rem; border-radius:9px; }
    }
    /* focus styles for keyboard accessibility */
    button.key:focus{ outline:3px solid rgba(6,182,212,0.12); outline-offset:2px; }
    .help{ text-align:center; font-size:.78rem; color:var(--muted); margin-top:10px }
  </style>
</head>
<body>
  <div class="wrap">
    <main class="calc" role="application" aria-label="Calculator">
      <header>
        <div>
          <div class="title">Calculator</div>
          <div class="subtitle">Basic • Mobile responsive</div>
        </div>
        <div aria-hidden="true" title="Lightweight">⚡</div>
      </header>

      <section class="display" aria-live="polite" aria-atomic="true">
        <div id="expression" class="expression" aria-hidden="false">0</div>
        <div id="result" class="result" aria-label="Result">0</div>
      </section>

      <section class="pad" role="group" aria-label="Calculator keypad">
        <!-- Row 1 -->
        <button class="key fn small" data-action="clear" aria-label="Clear (Escape)">C</button>
        <button class="key fn small" data-action="back" aria-label="Backspace (Backspace)">⌫</button>
        <button class="key fn small" data-action="percent" aria-label="Percent">%</button>
        <button class="key fn small" data-value="/" aria-label="Divide">÷</button>

        <!-- Row 2 -->
        <button class="key" data-value="7" aria-label="7">7</button>
        <button class="key" data-value="8" aria-label="8">8</button>
        <button class="key" data-value="9" aria-label="9">9</button>
        <button class="key fn" data-value="*" aria-label="Multiply">×</button>

        <!-- Row 3 -->
        <button class="key" data-value="4" aria-label="4">4</button>
        <button class="key" data-value="5" aria-label="5">5</button>
        <button class="key" data-value="6" aria-label="6">6</button>
        <button class="key fn" data-value="-" aria-label="Minus">−</button>

        <!-- Row 4 -->
        <button class="key" data-value="1" aria-label="1">1</button>
        <button class="key" data-value="2" aria-label="2">2</button>
        <button class="key" data-value="3" aria-label="3">3</button>
        <button class="key fn" data-value="+" aria-label="Plus">+</button>

        <!-- Row 5 -->
        <button class="key" data-action="neg" aria-label="Toggle plus minus">±</button>
        <button class="key" data-value="0" aria-label="0">0</button>
        <button class="key" data-value="." aria-label="Decimal">.</button>
        <button class="key equal" data-action="equals" aria-label="Equals (Enter)">=</button>
      </section>

      <div class="help">Keyboard: digits, + - * /, Enter =, Backspace, Escape = clear</div>
    </main>
  </div>

  <script>
    (function(){
      const exprEl = document.getElementById('expression');
      const resEl = document.getElementById('result');
      const keys = document.querySelectorAll('button.key');

      let expression = ''; // user's typed expression (human-friendly with × ÷)
      let lastResult = null;

      const updateDisplay = () => {
        exprEl.textContent = expression || '0';
        resEl.textContent = (lastResult === null) ? '0' : String(lastResult);
      };

      const sanitizeForEval = (s) => {
        // Accept digits, operators, parentheses, decimal point and spaces and percent
        // Replace human-friendly symbols with JS equivalents:
        s = s.replace(/×/g, '*').replace(/÷/g, '/').replace(/−/g, '-');
        // Convert percent tokens: "50%" => "(50/100)" and "(... )%" => "((...)/100)"
        s = s.replace(/(\d+(\.\d+)?)%/g, '($1/100)');
        s = s.replace(/\)%/g, ')/100'); // handles ")%" case
        // Only allow safe characters now
        if (/[^0-9+\-*/().% \t]/.test(s)) throw new Error('Invalid characters in expression');
        return s;
      };

      const safeEval = (s) => {
        // Evaluate using Function after sanitizing
        const safer = sanitizeForEval(s);
        // Disallow consecutive operators like "**" or "*/"
        if (/[\+\-*/]{2,}/.test(safer.replace(/\s+/g,'')) && !/(\*\*)/.test(safer)) {
          // allow negative numbers like 5*-3 (that's fine), but reject typical malformed patterns above
        }
        try {
          // Use Function to avoid eval direct; still limited but okay for this simple calculator
          const fn = new Function('return ' + safer);
          let val = fn();
          if (typeof val === 'number' && !isFinite(val)) throw new Error('Math error');
          // Round floats to avoid long fractions
          if (typeof val === 'number') {
            // If very close to integer, show integer
            if (Math.abs(val - Math.round(val)) < 1e-12) val = Math.round(val);
            else val = parseFloat(val.toFixed(12)); // keep up to 12 decimal places
          }
          return val;
        } catch (e) {
          throw new Error('Invalid expression');
        }
      };

      const append = (token) => {
        // Prevent two operators in a row (except minus for negative)
        const lastChar = expression.slice(-1);
        const ops = ['+','-','*','/'];
        if (ops.includes(token)) {
          if (expression === '' && token !== '-') {
            // don't start with + * /
            return;
          }
          if (ops.includes(lastChar)) {
            // replace previous operator with new one (smart behavior)
            expression = expression.slice(0,-1) + token;
            updateDisplay();
            return;
          }
        }
        // prevent multiple decimals in the same number
        if (token === '.') {
          // find last number portion
          const match = expression.match(/(\d+\.?\d*)$/);
          if (match && match[0].includes('.')) return;
          if (!match) {
            // if nothing, prepend 0.
            expression += '0';
          }
        }
        expression += token;
        updateDisplay();
      };

      const clearAll = () => { expression = ''; lastResult = null; updateDisplay(); };
      const backspace = () => {
        if (!expression) return;
        expression = expression.slice(0, -1);
        updateDisplay();
      };
      const compute = () => {
        if (!expression) return;
        try {
          const val = safeEval(expression);
          lastResult = val;
          expression = String(val);
          updateDisplay();
        } catch (e) {
          // show brief error then restore expression
          resEl.textContent = 'Error';
          setTimeout(()=> updateDisplay(), 800);
        }
      };

      const percent = () => {
        // If expression empty ignore. Otherwise append % which will be handled in eval conversion.
        if (!expression) return;
        // Do not append if last char is operator (can't do % after operator)
        const lastChar = expression.slice(-1);
        if (['+','-','*','/','('].includes(lastChar)) return;
        expression += '%';
        updateDisplay();
      };

      const toggleNeg = () => {
        // Toggle sign of the last number in the expression.
        // Find the last number token (possibly with decimal)
        const re = /(-?\d+(\.\d+)?)$/;
        const m = expression.match(re);
        if (m) {
          const num = m[1];
          if (num.startsWith('-')) {
            expression = expression.slice(0, -num.length) + num.slice(1);
          } else {
            expression = expression.slice(0, -num.length) + '(' + '-' + num + ')';
          }
        } else {
          // if empty, start with negative zero
          expression = '-';
        }
        updateDisplay();
      };

      keys.forEach(k => {
        k.addEventListener('click', (ev) => {
          const v = k.getAttribute('data-value');
          const a = k.getAttribute('data-action');
          if (a) {
            if (a === 'clear') clearAll();
            if (a === 'back') backspace();
            if (a === 'equals') compute();
            if (a === 'percent') percent();
            if (a === 'neg') toggleNeg();
          } else if (v) {
            append(v);
          }
        });
      });

      // Keyboard support
      window.addEventListener('keydown', (e) => {
        if (e.metaKey || e.ctrlKey) return; // allow copy/paste etc
        const key = e.key;
        if (/^[0-9]$/.test(key)) {
          append(key);
          e.preventDefault();
        } else if (key === '.' || key === ',') {
          append('.');
          e.preventDefault();
        } else if (key === '+' || key === '-' || key === '*' || key === '/') {
          append(key);
          e.preventDefault();
        } else if (key === 'Enter' || key === '=') {
          compute();
          e.preventDefault();
        } else if (key === 'Backspace') {
          backspace();
          e.preventDefault();
        } else if (key === 'Escape' || key === 'Esc') {
          clearAll();
          e.preventDefault();
        } else if (key === '%') {
          percent();
          e.preventDefault();
        } else if (key === 'p' && (e.shiftKey)) { // quick +/- (Shift+p) - optional
          toggleNeg();
          e.preventDefault();
        }
      });

      // initialize
      clearAll();
    })();
  </script>
</body>
</html>